## 数据库设计注意事项
#add by stefan 20190705 14:37

##1. 多人共用数据  
#比如 公会评论区、英雄评论区、排行榜等 作为玩家共用的数据表；
#1.1 可使用单一程序服务模块实现CURD操作，但针对复杂计算处理逻辑，不能放在此模块实现，不然容易造成效率方面的问题，导致玩家rpc远程调用超时无法完成相应的操作，故公共数据模块尽可能精简，只完成CURD操作即可；
#1.2 存储数据方面，不可无限制的添加数据，可以设置时间期限或者内容长度限制，对于最早存储的可以干掉，在不影响正常数据更新和不影响玩家体验的情况下可以这么干；
#1.3 数据更新方面，不可直接加载db数据进行更新，达到client数据实时性效果，在需求允许的情况下，可实现xxx秒内client主动刷新请求更新表现，在服务器更新方面可以接受；或者服务器这边实现暂时缓存，比如排行榜中玩家头像、战力、编队、名字等数据，写入到缓存中，可以在他们变化时更新排行榜数据，此做法只能解决，当前服务器不会影响数据表现的实时性，但是却无法解决玩家在其在游戏的其他服务器登陆获取的数据是最新的，故，此刻就需要一个远端的rpc——世界服（Big World Server），将玩家缓存的数据都更新到BW里，需要时，通过rpc调用k-v形式获取相应的数据即可，这样可以在任何服务器更新得到最新的数据。
#1.4 s-c 网络协议方面，不能完全将具体表现数据都传送给client，如果有些数据client能通过key获取value的介质，server就不需要把所有数据都传给client，如此，可减少网络流量数据的频繁交互，常用的网络协议如protobuf。

##2. 单人数据
#比如 玩家、装备、英雄等
#1.1 存储简单，只涉及到单个玩家，只需要关心自己的数据即可，只需要通过key-value来获取，关系型还是非关系型数据库都可以实现；
#1.2 只存可变数据，不变数据，则存相应的key，通过配置config获取数据；
#1.3 相同的，跟多人一样，遇到多模块普遍使用的数据，如玩家等级、玩家头像、玩家战力等时，创建缓存数据，Set和Get 对缓存进行更新和获取，如此不需要实时操作db增加db的压力，内存操作远比load db数据快的多。
#1.4 数据结构不宜设计的过于复杂，越复杂越容易出bug，越不好维护，初期设计不宜设计过于复杂，减少维护成本，而且每次存储数据不宜太大，一般存在一些异常情况：数据过大，有可能是有外部搞事情的黑客或者不法分子，破解网络协议包，频繁发送错误数据，达到破坏数据库的情况，所以存储数据时，要判断数据的合法性（大小和结构准备性）；

# redis主从切换(https://blog.51cto.com/baoyc/2420276)
